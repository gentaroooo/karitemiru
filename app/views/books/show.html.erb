<div class="container pt-5">
  <div class="row mb-3">
    <div class="col-lg-8 offset-lg-2">
      <h1><%= t('.title') %></h1>
      <!-- 掲示板内容 -->
      <div class="card mb-4 p-3">
        <div class="row g-0">
          <div class="col-5">
            <%= image_tag @book.image_link.blank? ? 'sample.jpeg' : @book.image_link, class: 'img-fluid border' %>
          </div>
          <div class="col-7">
            <div class="card-body">
              <h5 class="card-title"><%= @book.title %></h5>
              <p class="card-text mb-2"><%= @book.authors.pluck(:name).join(', ')&.truncate(50) %></p>
              <p class="card-text"><small class="text-muted"><%= @book.published_date %></small></p>
              <%= link_to '詳細を見る', @book.info_link, target: '_blank' %>
            </div>
          </div>
          <% if current_user.own?(@book) %> 
            <ul class='crud-menu-btn list-inline float-right'>
              <li class="list-inline-item">
                <%= link_to book_path(@book), id: "button-delete-#{@book.id}", method: :delete, data: { confirm: t('defaults.message.delete_confirm') } do %>
                  <%= icon 'fas', 'trash' %>
                <% end %>
              </li>
            </ul>
          <% end  %>
        </div>
      </div>
      
      <article class="card">
        <div class="card-body">
          <div class='row'>
            <div class='col-md-9'>

              <%
=begin%>
 <% @hash.each do |a,b| %>
              <%= a %>
              <p><%= b %></P>
              <% end %> 
<%
=end%>
              <p id="choice"></p>
              <%
=begin%>
 <script src="calil.js"></script> 
<%
=end%>

              <script>
                $(document).ready(function(){ 
                  $.ajax({
                    type: 'GET',
                    url: 'https://api.calil.jp/check',
                    data:{
                      appkey: "<%= ENV['APP_KEY'] %>",
                      isbn: Number("<%= @book.systemid %>"),
                      systemid: 'Kanagawa_Hiratsuka',
                    },
                    dataType: 'jsonp',
                    jsonp: 'callback',//コールバックパラメータ名の指定
                    //jsonpCallback: 'testCallback',//callback関数名を自分で指名した場合
                  })
                    .done(function(data){
                      console.log(data)
                      const test = data.books[Number("<%= @book.systemid %>")].Kanagawa_Hiratsuka.libkey
                      Object.keys(test).forEach( function(value) {
                         $("#choice").after(`<div>${value} : ${this[value]} </div>`)
                      }, test)
                    })
                    .fail(function(data){
                      $("#jsonp").append("エラーです");
                    });
                });
              </script>  
              
            
            </div>
          </div>
        </div>
      </article>
    </div>
  </div>
</div>